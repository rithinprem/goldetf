<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gold Market Dashboard</title>
  <style>
    /* ---------- RESET ---------- */
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}

    /* ---------- VARIABLES ---------- */
    :root{
      --bg:#f5f7fa;
      --header:#ffffff;
      --text:#222;
      --subtle:#666;
      --border:#e0e0e0;
      --positive:#16a34a;   /* green  */
      --negative:#dc2626;   /* red    */
      --accent:#0052cc;     /* corporate blue */
      --radius:8px;
      --shadow:0 1px 3px rgba(0,0,0,.08);
    }

    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:2rem 1rem;
      min-height:100vh;
    }
    h1{
      font-size:1.5rem;
      font-weight:600;
      margin-bottom:1.5rem;
      color:var(--accent);
    }

    /* ---------- CARD ---------- */
    .card{
      background:var(--header);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      width:100%;
      max-width:1100px;
      overflow:hidden;
    }
    .card-header{
      background:var(--accent);
      color:#fff;
      padding:1rem 1.25rem;
      font-weight:600;
      font-size:1.05rem;
    }

    /* ---------- TABLE ---------- */
    .table-wrapper{overflow-x:auto}
    table{
      width:100%;
      border-collapse:collapse;
      font-size:.9rem;
    }
    thead{background:var(--bg)}
    th,td{padding:.75rem 1rem;text-align:right;border-bottom:1px solid var(--border)}
    th:first-child,td:first-child{text-align:left}   /* Date column */
    tbody tr:hover{background:#fafbfc}
    .num{font-variant-numeric:tabular-nums}

    /* ---------- DELTA COLOURS ---------- */
    .delta.positive{color:var(--positive);font-weight:600}
    .delta.negative{color:var(--negative);font-weight:600}

    /* ---------- BUTTON ---------- */
    .btn-wrapper{margin-top:1.25rem}
    button{
      background:var(--accent);
      color:#fff;
      border:none;
      padding:.6rem 1.4rem;
      font-size:.95rem;
      font-weight:500;
      border-radius:var(--radius);
      cursor:pointer;
      transition:background .2s;
    }
    button:hover{background:#0040a8}
    button:disabled{opacity:.55;cursor:not-allowed}

    /* ---------- PHONE ---------- */
    @media(max-width:600px){
      body{padding:1rem .5rem}
      h1{font-size:1.25rem}
      th,td{padding:.5rem .6rem;font-size:.8rem}
    }
  </style>
</head>
<body>

  <h1>Gold INR Daily Tracker</h1>

  <div class="card">
    <div class="card-header">Market Data</div>
    <div class="table-wrapper">
      <table id="dataTable">
        <thead>
          <tr>
            <th>Date-Time</th>
            <th>Prev Close</th>
            <th>Pre-Market Price</th>
            <th>Current Day</th>
            <th>Delta</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <div class="btn-wrapper">
    <button id="refreshBtn">Refresh</button>
  </div>

  <script>
    async function fetchData(){
      const btn=document.getElementById('refreshBtn');
      btn.disabled=true;
      btn.textContent='Loadingâ€¦';

      try{
        const res=await fetch('/data');
        const rows=await res.json();

        const tbody=document.querySelector('#dataTable tbody');
        tbody.innerHTML='';

        rows.forEach(r=>{
          const tr=document.createElement('tr');

          const deltaVal=parseFloat(r.delta);
          const deltaClass=deltaVal>=0?'positive':'negative';

          tr.innerHTML=`
            <td>${r.datetime||''}</td>
            <td class="num">${Number(r.prev_close||0).toLocaleString('en-IN',{maximumFractionDigits:2})}</td>
            <td class="num">${Number(r['pre-market-price']||0).toLocaleString('en-IN',{maximumFractionDigits:2})}</td>
            <td>${r.current_day||''}</td>
            <td class="delta ${deltaClass}">${r.delta||''}</td>`;
          tbody.appendChild(tr);
        });

      }catch(err){
        alert('Error fetching data');
        console.error(err);
      }finally{
        btn.disabled=false;
        btn.textContent='Refresh';
      }
    }

    document.getElementById('refreshBtn').addEventListener('click',fetchData);
    window.addEventListener('DOMContentLoaded',fetchData);
  </script>

</body>
</html>